import{D as S,E,G as R,r as u,o as H,w as I,h as A,a as j,b as z,c as o,d as l,F as g,k as U,j as t,t as y,e as P,m as D,i as F,n as k,H as G}from"./index.f9dfb1df.js";function Z(){const{create:f,get:c,getRow:T,subscribe:V,uploadFile:h,getTempFileURL:x}=S();E();const{user:m}=R();return{addComment:async n=>{const d={...n,userID:m.value.id};return await f("comments",d)},getComments:async n=>await c("comments_detail",{eq:n}),uploadCommentAttachment:async n=>{let d=Date.now()+"-"+n.name;const{data:b,error:p}=await h("commentattachments",d,n);return{data:b,error:p}},getCommentAttachmentURL:async n=>await x("commentattachments",n)}}const $={class:"p-component mComments"},J={class:"mCommentHeader"},K=["innerHTML"],O=["onClick"],Q=t("i",{class:"pi pi-file"},null,-1),W={class:G("mCommentInput")},X=t("span",{class:"ql-formats"},[t("button",{class:"ql-bold"}),t("button",{class:"ql-italic"}),t("button",{class:"ql-underline"})],-1),Y=t("span",{class:"ql-formats"},[t("button",{class:"ql-list",type:"button",value:"ordered"},[t("svg",{viewBox:"0 0 18 18"},[t("line",{class:"ql-stroke",x1:"7",x2:"15",y1:"4",y2:"4"}),t("line",{class:"ql-stroke",x1:"7",x2:"15",y1:"9",y2:"9"}),t("line",{class:"ql-stroke",x1:"7",x2:"15",y1:"14",y2:"14"}),t("line",{class:"ql-stroke ql-thin",x1:"2.5",x2:"4.5",y1:"5.5",y2:"5.5"}),t("path",{class:"ql-fill",d:"M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z"}),t("path",{class:"ql-stroke ql-thin",d:"M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156"}),t("path",{class:"ql-stroke ql-thin",d:"M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109"})])]),t("button",{class:"ql-list",type:"button",value:"bullet"},[t("svg",{viewBox:"0 0 18 18"},[t("line",{class:"ql-stroke",x1:"6",x2:"15",y1:"4",y2:"4"}),t("line",{class:"ql-stroke",x1:"6",x2:"15",y1:"9",y2:"9"}),t("line",{class:"ql-stroke",x1:"6",x2:"15",y1:"14",y2:"14"}),t("line",{class:"ql-stroke",x1:"3",x2:"3",y1:"4",y2:"4"}),t("line",{class:"ql-stroke",x1:"3",x2:"3",y1:"9",y2:"9"}),t("line",{class:"ql-stroke",x1:"3",x2:"3",y1:"14",y2:"14"})])]),t("select",{class:"ql-align",style:{display:"none"}},[t("option",{defaultvalue:""}),t("option",{value:"center"}),t("option",{value:"right"}),t("option",{value:"justify"})])],-1),tt=t("span",{class:"ql-formats"},[t("button",{class:"ql-link"})],-1),et={class:"ql-formats"},st=["onClick"],at={key:0},nt=t("p",null,"Drag and drop files to here to upload.",-1),ct={__name:"mComments",props:["attachNewCommentTo","findCommentsAttachedTo"],setup(f){const c=f,{addComment:T,getComments:V,uploadCommentAttachment:h,getCommentAttachmentURL:x}=Z(),m=u(),_=u([]),i=u([]),C=u([]);u(""),u([{type:"editor",key:"comment",label:"Comment",placeholder:"Enter your comment here",class:"mb-0 sd"},{type:"fileUpload",key:"attachments",label:"upload File",placeholder:"Upload a file"}]);const B=async a=>{x(a).then(s=>{const r=s.data.signedUrl;window.open(r,"_blank")})},n=async()=>{let a={comment:m.value};if(i.value&&i.value[0]){let r=[];for(var s=0;s<i.value.length;s++){const{data:q,error:w}=await h(i.value[s]);if(w)return!1;r.push(q.path)}a.attachments=r}await T({...c.attachNewCommentTo,...a}),m.value={},p(c.findCommentsAttachedTo)},d=async a=>{i.value=a.files},b=async a=>{h(a.files[0])};H(async()=>{p(c.findCommentsAttachedTo)}),I(()=>c.findCommentsAttachedTo,async(a,s)=>{p(a)});const p=async a=>{if(a){const{data:s}=await V(a);C.value=s}else C.value=[]};return(a,s)=>{const r=A("Editor"),q=A("FileUpload"),w=A("Button"),L=j("auto-animate");return z((o(),l("div",$,[(o(!0),l(g,null,U(C.value,e=>(o(),l("div",{class:"mComment",key:e.id},[t("div",J,y(e.formCreated)+" - "+y(e.displayName),1),t("div",{class:"mCommentText white-space-normal",innerHTML:e.comment},null,8,K),e.attachments?(o(!0),l(g,{key:0},U(e.attachments,v=>(o(),l("div",{class:"mCommentAttachment",key:v,onClick:M=>B(v)},[Q,P(" "+y(v.substring(14)),1)],8,O))),128)):D("",!0)]))),128)),t("div",W,[F(q,{name:"mFileUpload",multiple:!0,maxFileSize:1e8,customUpload:!0,onSelect:s[1]||(s[1]=e=>d(e)),onUploader:s[2]||(s[2]=e=>b(e)),auto:!1},{header:k(({chooseCallback:e,uploadCallback:v,clearCallback:M,files:ot})=>[F(r,{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=N=>m.value=N)},{toolbar:k(()=>[X,Y,tt,t("span",et,[t("button",{class:"pi pi-paperclip",onClick:e},null,8,st)])]),_:2},1032,["modelValue"])]),content:k(()=>[_.value&&_.value[0]?(o(),l("ul",at,[(o(!0),l(g,null,U(_.value[0],e=>(o(),l("li",{key:e},y(e.name)+" - "+y(e.size)+" bytes",1))),128))])):D("",!0)]),empty:k(()=>[nt]),_:1}),F(w,{class:"justify-content-end p-button-sm mCommentInputSubmitButton",onClick:n,label:"Post",style:{width:"100%"}})])])),[[L]])}}};export{ct as _,Z as u};
